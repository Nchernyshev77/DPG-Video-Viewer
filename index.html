<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DPG Video Viewer</title>
  <style>
    :root{ --bg:#000; --bg-soft:#0c0c0c; --panel:#111; --muted:#9aa3ad; --text:#e8e8e8; --line:#222; --accent:#4aa3ff; }
    *{box-sizing:border-box}
    html,body{height:100%}
    html{background:var(--bg)}
    body{margin:0; background:var(--bg); color:var(--text); font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial; overflow:hidden}

    /* Minimal dark UI */
    #app{position:fixed; inset:0; display:flex; flex-direction:column}
    #toolbar{display:flex; gap:.5rem; align-items:center; padding:.5rem .75rem; background:var(--panel); border-bottom:1px solid var(--line)}
    .group{display:flex; align-items:center; gap:.5rem}
    .btn{display:inline-flex; align-items:center; gap:.45rem; background:#151515; color:var(--text); border:1px solid var(--line); padding:.42rem .62rem; border-radius:8px; cursor:pointer; user-select:none}
    .btn:hover{background:#1b1b1b}
    .btn:active{transform:translateY(1px)}
    .btn .i{width:14px;height:14px;display:inline-block}
    .btn svg{width:14px;height:14px;display:block}
    input[type="file"]{display:none}
    select{background:#151515; color:var(--text); border:1px solid var(--line); border-radius:8px; padding:.35rem .5rem; max-width:40vw}

    /* range track + thumb â€” same everywhere (normal + fullscreen) */
    input[type="range"], #fsBar input[type="range"]{ -webkit-appearance:none; appearance:none; height:4px; background:#232323; border-radius:999px; outline:none; padding:0 }
    /* WebKit */
    input[type="range"]::-webkit-slider-runnable-track, #fsBar input[type="range"]::-webkit-slider-runnable-track{ height:4px; background:#232323; border-radius:999px }
    input[type="range"]::-webkit-slider-thumb, #fsBar input[type="range"]::-webkit-slider-thumb{ -webkit-appearance:none; width:14px; height:14px; border-radius:50%; background:var(--accent); border:0; margin-top:-5px }
    /* Firefox */
    input[type="range"]::-moz-range-track, #fsBar input[type="range"]::-moz-range-track{ height:4px; background:#232323; border-radius:999px }
    input[type="range"]::-moz-range-progress, #fsBar input[type="range"]::-moz-range-progress{ height:4px; background:#232323; border-radius:999px }
    input[type="range"]::-moz-range-thumb, #fsBar input[type="range"]::-moz-range-thumb{ width:14px; height:14px; border-radius:50%; background:var(--accent); border:0 }
    /* Old Edge/IE */
    
    
    

    #time{flex:1; min-width:160px}
    #viewer{position:relative; flex:1; min-height:0; background:var(--bg)}
    canvas{display:block; position:absolute; inset:0; z-index:0; background:var(--bg)}

    /* start/empty state */
    #introBackdrop{position:absolute; inset:0; display:none; background:radial-gradient(ellipse at center, var(--bg-soft) 0%, #0a0a0a 55%, var(--bg) 100%); z-index:1}
    #introBackdrop.show{display:block}
    #status{position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); background:#151515e6; border:1px solid var(--line); padding:1rem 1.25rem; border-radius:10px; display:none; text-align:center; max-width:min(90vw,800px); z-index:2; color:#fff}
    #status.show{display:block}
    #status progress{width:260px}

    #dropmask{position:absolute; inset:0; display:none; place-items:center; background:rgba(74,163,255,.08); border:2px dashed var(--accent); border-radius:12px; color:#bfe1ff; font-weight:600; z-index:2}
    #dropmask.show{display:grid}

    /* compact buttons */
    #fsBtn{width:36px; justify-content:center}
    #closeAll{width:auto}
    #infoBtn{width:auto}

    /* fullscreen timeline overlay */
    #fsBar{position:absolute; left:50%; bottom:10px; transform:translateX(-50%); display:none; align-items:center; gap:.5rem; background:#101010; border:1px solid #2a2a2a; border-radius:10px; padding:.45rem .6rem; z-index:3}
    #fsBar.show{display:flex}
    #fsBar input[type="range"]{width:min(62vw,900px)}
    #fsTime{min-width:90px; opacity:.9}

    /* HUD (fps/frame) */
    #hud{position:absolute; top:8px; left:8px; z-index:3; background:#101010cc; border:1px solid #2a2a2a; padding:.25rem .5rem; border-radius:8px; font-size:.9rem; color:#d8d8d8}
    #hud .sep{opacity:.6; margin:0 .25rem}

    /* Info panel */
    #infoPanel{position:fixed; top:52px; right:12px; width:320px; max-width:90vw; background:#121212; color:#ddd; border:1px solid #2a2a2a; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.35); display:none; z-index:10}
    #infoPanel.show{display:block}
    #infoPanel header{padding:.6rem .8rem; border-bottom:1px solid #222; font-weight:600}
    #infoPanel .body{padding:.6rem .8rem; font-size:.95rem}
    #infoPanel .body dl{display:grid; grid-template-columns:auto 1fr; gap:.35rem .75rem; margin:0}
    #infoPanel .body dt{color:#9aa3ad}
    #infoPanel .body dd{margin:0}

    /* playlist custom dropdown */
    #playlist{display:none}
    #plistPanel{position:fixed; display:none; z-index:20; background:#121212; border:1px solid #2a2a2a; border-radius:10px; min-width:260px; max-width:80vw; max-height:50vh; overflow:auto; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    #plistPanel.show{display:block}
    #plistPanel .plItem{display:flex; align-items:center; gap:.5rem; padding:.45rem .6rem; border-bottom:1px solid #1b1b1b; cursor:pointer; transition:background-color .12s ease} 
    #plistPanel .plItem:hover{background:#1b1b1b}
    #plistPanel .plItem:last-child{border-bottom:0}
    #plistPanel .name{flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    #plistPanel .idx{opacity:.6; font-variant-numeric:tabular-nums; width:2ch}
    #plistPanel .x{background:transparent; border:1px solid #333; color:#aaa; width:22px; height:22px; border-radius:6px; cursor:pointer; display:inline-flex; align-items:center; justify-content:center}
    #plistPanel .x:hover{background:#1a1a1a; color:#fff; border-color:#444}
    #plistPanel .active .name{color:#fff; font-weight:600}

    /* hide Prev/Next buttons per request */
    
  </style>
  <meta name="referrer" content="no-referrer">
  <script src="https://accounts.google.com/gsi/client" async defer></script>

<style id="appLinkModalStyles">
/* Compact dark modal for app link */
#appLinkModal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9999; }
#appLinkModal.show{ display:flex; }
#appLinkModal .backdrop{ position:absolute; inset:0; background:#000c; backdrop-filter: blur(2px); }
#appLinkModal .card{ position:relative; background:#0e0e10; color:#f2f2f2; border:1px solid #2a2a2e; border-radius:12px; padding:14px; width:min(480px, 92vw); box-shadow:0 10px 30px #000a; font-family:inherit; }
#appLinkModal h3{ margin:0 0 8px 0; font-weight:600; font-size:15px; }
#appLinkModal .row{ display:flex; gap:.5rem; align-items:center; }
#appLinkModal input{ flex:1; background:#1e1e22; color:#fff; border:1px solid #3b3b40; border-radius:8px; padding:.55rem .65rem; font-size:13px; }
#copyAppLink{ display:inline-flex; align-items:center; justify-content:center; border:1px solid #3b3b40; background:#1a1a1f; color:#fff; border-radius:8px; padding:.5rem .6rem; cursor:pointer; }
#copyAppLink svg{ width:16px; height:16px; }
#copyAppLink:active{ transform:translateY(1px); }
#appLinkClose{ margin-top:8px; }
#openAppLink{ margin-left:auto; }
.small-muted{ opacity:.75; font-size:11px; margin-top:6px; }
</style>

</head>
<body>

<!-- Robust capture of chosen files (file input, DnD, showOpenFilePicker) -->
<script>
(function(){
  const id = new URLSearchParams(window.location.search).get('id');
  if (!id) return;

  (async () => {
    try {
      await ensureDriveToken();                 // silent attempt
      if (!driveAccessToken) throw new Error('needs_user_gesture');
      await loadById(id);                       // or loadFromCacheOrDrive(id)
    } catch {
      const toolbar = document.getElementById('toolbar') || document.body;
      const btn = document.createElement('button');
      btn.className = 'btn';
      btn.textContent = 'Open video';
      btn.title = 'Authorize Google Drive and open the video';
      btn.onclick = async () => {
        try {
          await ensureDriveToken({ interactive: true });
          await loadById(id);
          btn.remove();
        } catch (e) {
          alert((e && e.message) || String(e));
        }
      };
      toolbar.appendChild(btn);
    }
  })();
})();})();
</script>


<div id="appLinkModal" aria-hidden="true">
  <div class="backdrop"></div>
  <div class="card">
    <h3>App link</h3>
    <div class="row">
      <input id="appLinkField" readonly>
      <button id="copyAppLink" title="Copy link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
      </button>
    </div>
    <div class="row" style="margin-top:8px; justify-content:flex-end;">
      <button id="openAppLink" class="btn">Open</button>
      <button id="appLinkClose" class="btn">Close</button>
    </div>
    <div class="small-muted">The link is copied automatically. Use the copy button to copy again.</div>
  </div>
</div>

</body>
</html>
